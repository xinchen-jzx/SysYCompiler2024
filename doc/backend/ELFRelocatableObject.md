在链接生成可执行文件时，程序的不同部分被组织成特定的方式以优化内存使用和执行效率。以下是 `.bss`、`.data` 和 `.rodata` 部分的区别：

1. **`.bss` (Block Started by Symbol)**：
   - **目的**：此部分用于未初始化的全局和静态变量。名称 `.bss` 源自旧汇编语法，意思是“由符号开始的块”。
   - **内存初始化**：在程序开始执行之前，`.bss` 部分的变量由运行时系统初始化为零。
   - **存储**：此部分不会占用可执行文件本身的空间。相反，它仅在程序加载时保留内存空间。`.bss` 部分的大小记录在可执行文件中，但实际内容不存储。

2. **`.data` (Initialized Data)**：
   - **目的**：此部分用于程序员在程序开始执行之前初始化为特定值的全局和静态变量。
   - **内存初始化**：`.data` 部分的变量保留其指定的初始值。
   - **存储**：变量的值存储在可执行文件中，此部分在可执行文件中占用空间。当程序加载到内存时，这些初始值被复制到分配的内存中。

3. **`.rodata` (Read-Only Data)**：
   - **目的**：此部分用于只读的全局和静态数据。通常，这包括字符串字面量和其他在运行时不应修改的常量数据。
   - **内存初始化**：`.rodata` 部分的数据被初始化，并在程序执行过程中保持不变。
   - **存储**：`.rodata` 部分包含在可执行文件中并占用空间。当程序加载时，此部分被放置在标记为只读的内存区域，以防止意外修改。

### 区别总结

- **内容**：
  - `.bss`：未初始化数据（默认为零）。
  - `.data`：已初始化数据。
  - `.rodata`：只读已初始化数据。

- **内存使用**：
  - `.bss`：分配但不存储在可执行文件中。
  - `.data`：存储在可执行文件中并分配在内存中。
  - `.rodata`：存储在可执行文件中并分配在内存中（只读）。

- **权限**：
  - `.bss` 和 `.data` 部分通常是可读写的。
  - `.rodata` 部分是只读的。

理解这些部分对于在链接和执行程序时进行有效的内存管理和程序优化至关重要。


可重定位目标文件

图7.3显示了典型的ELF可重定位目标文件的格式。ELF头部以一个16字节的序列开始，描述了生成该文件的系统的字大小和字节排序方式。ELF头部的其余部分包含允许链接器解析和解释目标文件的信息。这包括ELF头部的大小、目标文件类型（例如，可重定位、可执行或共享）、机器类型（例如，x86-64）、节头表的文件偏移以及节头表中条目的大小和数量。各种节的位置和大小由节头表描述，该表包含目标文件中每个节的固定大小条目。

夹在ELF头部和节头表之间的是各个节。典型的ELF可重定位目标文件包含以下节：

- **.text**：已编译程序的机器代码。
- **.rodata**：只读数据，例如printf语句中的格式字符串和switch语句的跳转表。
- **.data**：已初始化的全局和静态C变量。局部C变量在运行时保存在堆栈上，不会出现在.data或.bss节中。
- **.bss**：未初始化的全局和静态C变量，以及任何初始化为零的全局或静态变量。此节在目标文件中不占用实际空间；它只是一个占位符。目标文件格式区分已初始化和未初始化变量以提高空间效率：未初始化变量不需要在目标文件中占用任何实际磁盘空间。在运行时，这些变量在内存中分配，并初始化为零。
- **.symtab**：包含程序中定义和引用的函数和全局变量信息的符号表。一些程序员错误地认为必须使用-g选项编译程序才能获得符号表信息。事实上，每个可重定位目标文件都有一个.symtab符号表（除非程序员使用strip命令特意移除了它）。然而，与编译器内部的符号表不同，.symtab符号表不包含局部变量的条目。
- **.rel.text**：需要在链接器将此目标文件与其他文件合并时修改的位置列表，位于.text节中。通常，任何调用外部函数或引用全局变量的指令都需要修改。而调用局部函数的指令则不需要修改。需要注意的是，可执行目标文件中不需要重定位信息，通常会被省略，除非用户明确指示链接器包含它。
- **.rel.data**：引用或定义模块的全局变量的重定位信息。通常，任何初始化值为全局变量或外部定义函数地址的已初始化全局变量都需要修改。
- **.debug**：调试符号表，包含程序中定义的局部变量和typedefs、定义和引用的全局变量以及原始C源文件。只有在编译器驱动程序使用-g选项调用时才会存在。
- **.line**：原始C源程序中的行号与.text节中的机器代码指令之间的映射。只有在编译器驱动程序使用-g选项调用时才会存在。
- **.strtab**：符号表中的字符串表，包含.symtab和.debug节中的符号表条目和节头中的节名。字符串表是以空字符结尾的字符字符串序列。